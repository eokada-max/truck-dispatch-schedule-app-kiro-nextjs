# 要件定義書

## はじめに

本ドキュメントは、配送スケジュール管理アプリケーションにおいて、日付をまたぐスケジュール（深夜配送など）を適切に表示する機能の要件を定義します。

## 用語集

- **System**: 配送スケジュール管理アプリケーション
- **Schedule**: 配送計画（積み地日時、着地日時、担当ドライバー、車両などの情報を含む）
- **Multi-Day Schedule**: 積み地日時と着地日時が異なる日付にまたがるスケジュール（例：11/5 23:00 ～ 11/6 02:00）
- **Timeline View**: 時間軸に沿ってスケジュールを表示するカレンダービュー
- **Resource View**: 車両またはドライバーごとにスケジュールを表示するビュー
- **Schedule Card**: スケジュールを表示するUIカード要素

## 要件

### 要件1: 日付をまたぐスケジュールの視覚的表示

**ユーザーストーリー:** 配送管理者として、深夜配送など日付をまたぐスケジュールを一目で識別できるようにしたい。そうすることで、配送計画の全体像を正確に把握できる。

#### 受入基準

1. WHEN 積み地日時と着地日時が異なる日付である場合、THE System SHALL Schedule Cardに視覚的なインジケーター（アイコンまたはバッジ）を表示する
2. WHEN ユーザーがSchedule Cardにマウスオーバーした場合、THE System SHALL 積み地日時と着地日時の両方を含む詳細情報をツールチップで表示する
3. THE System SHALL Multi-Day Scheduleを通常のScheduleと異なる視覚スタイル（色、ボーダー、またはパターン）で表示する

### 要件2: Timeline Viewでの日付またぎ表示

**ユーザーストーリー:** 配送管理者として、Timeline Viewで日付をまたぐスケジュールが複数日にまたがって表示されることを期待する。そうすることで、各日の稼働状況を正確に把握できる。

#### 受入基準

1. WHEN Multi-Day ScheduleがTimeline Viewに表示される場合、THE System SHALL 積み地日時の日付列にSchedule Cardを表示する
2. WHEN Multi-Day Scheduleの着地日時が翌日以降である場合、THE System SHALL 着地日時の日付列にも視覚的な継続インジケーターを表示する
3. WHEN ユーザーがいずれかの日付列のSchedule Cardをクリックした場合、THE System SHALL 同一のスケジュール詳細フォームを開く

### 要件3: Resource Viewでの日付またぎ表示

**ユーザーストーリー:** 配送管理者として、Resource View（車両別・ドライバー別）で日付をまたぐスケジュールが適切に表示されることを期待する。そうすることで、リソースの稼働状況を正確に把握できる。

#### 受入基準

1. WHEN Multi-Day ScheduleがResource Viewに表示される場合、THE System SHALL 積み地日時の日付セルにSchedule Cardを表示する
2. WHEN Multi-Day Scheduleの着地日時が翌日以降である場合、THE System SHALL 着地日時の日付セルにも視覚的な継続インジケーターを表示する
3. THE System SHALL 同一のMulti-Day Scheduleに対する複数の表示要素を視覚的に関連付ける（同じ色、接続線、またはパターン）

### 要件4: ドラッグ&ドロップ操作の対応

**ユーザーストーリー:** 配送管理者として、日付をまたぐスケジュールをドラッグ&ドロップで移動できるようにしたい。そうすることで、効率的にスケジュールを調整できる。

#### 受入基準

1. WHEN ユーザーがMulti-Day ScheduleのSchedule Cardをドラッグした場合、THE System SHALL スケジュール全体（積み地日時と着地日時の両方）を移動対象とする
2. WHEN ユーザーがMulti-Day Scheduleを別の日付にドロップした場合、THE System SHALL 積み地日時と着地日時の日付を同じ日数分シフトする
3. WHEN ユーザーがMulti-Day Scheduleを別のリソース（車両またはドライバー）にドロップした場合、THE System SHALL 日時を変更せずにリソースのみを変更する

### 要件5: スケジュール作成・編集フォームの対応

**ユーザーストーリー:** 配送管理者として、スケジュール作成・編集フォームで日付をまたぐスケジュールを簡単に入力できるようにしたい。そうすることで、深夜配送などの計画を効率的に登録できる。

#### 受入基準

1. WHEN ユーザーが着地日時を積み地日時より前の時刻に設定した場合、THE System SHALL 警告メッセージを表示する
2. WHEN ユーザーが着地日時を積み地日時の翌日以降に設定した場合、THE System SHALL Multi-Day Scheduleとして保存する
3. THE System SHALL 積み地日時と着地日時の入力フィールドで日付と時刻の両方を明示的に入力可能にする

### 要件6: 競合検出の対応

**ユーザーストーリー:** 配送管理者として、日付をまたぐスケジュールが他のスケジュールと時間的に競合する場合に警告を受け取りたい。そうすることで、リソースの二重割り当てを防止できる。

#### 受入基準

1. WHEN Multi-Day Scheduleが同一リソースの他のScheduleと時間的に重複する場合、THE System SHALL 競合警告を表示する
2. THE System SHALL Multi-Day Scheduleの競合検出において、積み地日時から着地日時までの全時間範囲を考慮する
3. WHEN 競合が検出された場合、THE System SHALL 競合するScheduleの詳細情報を表示する
